# Laborat√≥rio de detec√ß√£o de firewall e malware - Seguran√ßa üíªüõ°üîí

<h3>Neste laborat√≥rio vamos utilizar o AWS Network Firewall para criar regras que bloqueiem malware e atividades maliciosas em nossa rede. Vamos aprender a inspecionar o tr√°fego, criar regras baseadas em Suricata para detectar e bloquear downloads de malware, e validar que essas prote√ß√µes est√£o funcionando corretamente.</h3>

**AWS Network Firewall**: Servi√ßo que oferece prote√ß√£o de firewall e detec√ß√£o de invas√µes para sua VPC. <br>

**Suricata**: Engine de detec√ß√£o de amea√ßas de c√≥digo aberto que utiliza rules para inspecionar o tr√°fego de rede. <br>

**Malware Detection**: Capacidade de bloquear downloads e acessos a sites conhecidos por distribuir malware. <br>

## Task 1: Confirm Reachability

Nesta task vamos confirmar que conseguimos alcan√ßar um site que cont√©m malware simulado. Conectamos √† inst√¢ncia EC2 e executamos comandos wget para baixar arquivos do site malware.wicar.org: <br>
![](images/2025-10-23-19-05-02.png)

Como podemos ver, conseguimos baixar os arquivos *js_crypto_miner.html* e *java_jre17_exec.html* com sucesso, o que significa que n√£o h√° nenhuma prote√ß√£o bloqueando esse acesso no momento.

## Task 2: Inspect the network firewall

Agora vamos acessar o painel do **AWS Network Firewall** para inspecionar a configura√ß√£o existente. Navegamos at√© o firewall chamado *LabFirewall*: <br>
![](images/2025-10-23-19-07-39.png)

Podemos ver que o firewall j√° est√° criado e associado √† pol√≠tica *LabFirewallPolicy*. Agora vamos acessar a pol√≠tica de firewall para ver as configura√ß√µes atuais: <br>
![](images/2025-10-23-19-10-31.png)

Aqui visualizamos a p√°gina de *Firewall policies*, onde podemos ver que n√£o h√° nenhum grupo de regras stateful associado √† pol√≠tica atualmente. Existem apenas configura√ß√µes de a√ß√µes padr√£o.

## Task 3: Create a firewall rule group

Agora vamos criar um grupo de regras de firewall para detectar e bloquear malware. Acessamos a op√ß√£o de criar um novo grupo de regras: <br>
![](images/2025-10-23-19-12-43.png)

Na primeira etapa, selecionamos o tipo de grupo de regras. Escolhemos **Stateful rule group** para inspecionar pacotes em contexto do fluxo de tr√°fego: <br>
![](images/2025-10-23-19-13-36.png)

Em seguida, descrevemos o grupo de regras com o nome *StatefulRuleGroup* e capacidade de 100. Na etapa de configura√ß√£o de regras, adicionamos regras Suricata compat√≠veis que bloqueiam URLs maliciosas. As regras definem que qualquer tentativa de acessar URLs contendo *MALWARE* ou *js_crypto_miner.html* e *java_jre17_exec.html* ser√° bloqueada: <br>
![](images/2025-10-23-19-15-31.png)

Continuamos com a cria√ß√£o do grupo de regras: <br>
![](images/2025-10-23-19-17-52.png)

O grupo de regras foi criado com sucesso, como confirmado pela mensagem verde indicando que o grupo *StatefulRuleGroup* foi criado.

## Task 4: Attach a rule group to the network firewall

Agora vamos associar o grupo de regras que acabamos de criar √† pol√≠tica de firewall. Voltamos √† p√°gina de regras do firewall: <br>
![](images/2025-10-23-19-20-18.png)

Aqui podemos ver a lista de grupos de regras dispon√≠veis. Selecionamos nosso *StatefulRuleGroup* e o adicionamos √† pol√≠tica. Ap√≥s clicar em "Add rule groups to policy", conseguimos adicionar o grupo: <br>
![](images/2025-10-23-19-21-20.png)

A pol√≠tica foi atualizada com sucesso, como confirmado pela mensagem verde. Agora o grupo de regras *StatefulRuleGroup* est√° associado √† pol√≠tica *LabFirewallPolicy* e est√° ativo na VPC.

## Task 5: Validate the solution

Agora vamos validar que as regras de firewall est√£o funcionando e bloqueando o acesso aos arquivos maliciosos. Conectamos novamente √† inst√¢ncia EC2 e tentamos baixar os mesmos arquivos de antes: <br>
![](images/2025-10-23-19-23-37.png)

Como podemos ver, agora os downloads est√£o sendo bloqueados! A inst√¢ncia tenta acessar o site *malware.wicar.org*, mas o Network Firewall bloqueia a requisi√ß√£o. Os comandos wget n√£o conseguem completar a conex√£o porque o firewall est√° interceptando o tr√°fego suspeito.

Para confirmar ainda mais, vamos ver que mesmo excluindo os arquivos e tentando novamente, eles continuam bloqueados: <br>
![](images/2025-10-23-19-27-56.png)

Os arquivos foram removidos, mas ao tentar baix√°-los novamente, o firewall bloqueia o acesso. Isso confirma que nossas regras Suricata est√£o funcionando corretamente e protegendo a rede contra tentativas de download de malware.

**Conclus√£o**: Implementamos com sucesso um Network Firewall na VPC com regras de detec√ß√£o de malware baseadas em Suricata. O firewall agora bloqueia qualquer tentativa de acessar URLs maliciosas conhecidas, protegendo os recursos da rede contra downloads e execu√ß√£o de malware.
